<app-front-basic-layout [loggedIn]="loggedIn">
  <div fxFlex fxLayoutAlign="center start" fxLayout="row" *ngIf="!loading" style="background-color: #EFEFEF">
    <div fxLayout="column" class="document" fxLayoutGap="15">
      <span fxLayout="row" fxLayoutGap="15" fxLayoutAlign="start center">
        <mat-icon>shopping_cart</mat-icon>
        <h1 class="no-margin no-padding">Din indkøbsvogn</h1>
      </span>
      <ng-container *ngIf="currentPurchaseOrder.orderLines.length !== 0">
        <table mat-table [dataSource]="orderLines" (matSortChange)="sortData($event)" matSort class="mat-elevation-z8">
          <ng-container matColumnDef="imageUrl">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              Billede
            </th>
            <td mat-cell *matCellDef="let line"><img class="table-img" [src]="line.item.imageUrl" [alt]="line.item.name"></td>
          </ng-container>

          <ng-container matColumnDef="name">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              Navn
            </th>
            <td mat-cell *matCellDef="let line"> {{line.item.name}} </td>
          </ng-container>

          <ng-container matColumnDef="itemPrice">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              Stykpris
            </th>
            <td mat-cell *matCellDef="let line"> {{line.item.price}} kr</td>
          </ng-container>

          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              Antal
            </th>
            <td mat-cell *matCellDef="let line">
                <input matInput [(ngModel)]="line.quantity" (ngModelChange)="updateLineQuantity(line)" class="table-input" type="number" min="1"
                       [value]="line.quantity" oninput="this.value = !!this.value ? Math.abs(this.value) : 1">
            </td>
          </ng-container>

          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              Pris
            </th>
            <td mat-cell *matCellDef="let line"> {{line.price}} kr</td>
          </ng-container>

          <ng-container matColumnDef="remove">
            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by status">
              Fjern
            </th>
            <td mat-cell *matCellDef="let line"> <button (click)="removeOrderLine(line)" color="warn" mat-mini-fab><mat-icon>remove</mat-icon></button> </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let user; columns: displayedColumns;"></tr>
        </table>
        <div fxFlex fxLayout="row" fxLayoutAlign="end center" fxLayoutGap="20">
          <button color="warn" type="button" (click)="resetPurchaseOrder()" mat-raised-button>
            <mat-icon>delete</mat-icon>
            Tøm indkøbsvogn
          </button>
          <button color="primary" (click)="goToPayment()" mat-raised-button>
            <mat-icon>payments</mat-icon>
            Gå til betaling
          </button>
        </div>
      </ng-container>
      <ng-container *ngIf="currentPurchaseOrder.orderLines.length === 0">
        <p>Din indkøbsvogn er tom. Gå til webshoppen for at tilføje nye vare</p>
        <button color="primary" routerLink="/webshop" mat-raised-button>Webshop</button>
      </ng-container>
    </div>
  </div>
</app-front-basic-layout>
